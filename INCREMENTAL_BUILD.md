# 构建优化说明

## 🚀 优化效果

通过以下优化，大幅提升构建和部署速度：

1. **npm 依赖缓存**：跳过重复安装依赖
2. **Hexo 数据库缓存**：Hexo 自动跳过未修改的文件
3. **浅克隆**：只获取最新代码，不拉取完整历史
4. **增量推送**：只推送变化的文件到 gh-pages

## 📦 可用命令

### 本地开发
```bash
# 快速构建（Hexo 自动跳过未修改文件）
npm run build

# 全量构建（清理后重新生成）
npm run build:full

# 快速部署（构建 + 部署）
npm run deploy:quick

# 本地预览
npm run server
```

## 🔄 GitHub Actions 自动部署

推送到 `main` 分支后，GitHub Actions 会：

1. 使用 npm 缓存加速依赖安装
2. 使用 Hexo 数据库缓存加速构建
3. Hexo 自动跳过未修改的文件
4. 增量推送到 gh-pages 分支

**预计部署时间**：
- 首次部署：2-3 分钟
- 后续部署：30-60 秒（快 2-4 倍）

## 💡 Hexo 内置增量机制

Hexo 本身已经支持增量构建：
- 自动检测文件修改时间
- 跳过未修改的文件
- 只重新生成变化的内容

不需要 `hexo clean` 的情况：
- 新增文章
- 修改文章内容
- 日常更新

需要 `hexo clean` 的情况：
- 修改配置文件
- 更换主题
- 构建出现异常

## 🎯 性能对比

假设博客有 50 篇文章：

| 操作 | 无缓存 | 有缓存 | 提升 |
|------|--------|--------|------|
| 安装依赖 | 60 秒 | 5 秒 | 12x |
| 新增 1 篇文章 | 45 秒 | 8 秒 | 5.6x |
| 修改 1 篇文章 | 45 秒 | 6 秒 | 7.5x |
| 总部署时间 | 180 秒 | 40 秒 | 4.5x |

## 📝 日常使用流程

```bash
# 1. 写文章
hexo new post "文章标题"

# 2. 本地预览
npm run server

# 3. 提交并推送（自动触发快速部署）
git add .
git commit -m "新增文章"
git push
```

## 🔧 技术细节

- **npm ci + cache**：缓存 node_modules，跳过重复安装
- **Hexo db.json**：记录文件状态，自动增量构建
- **浅克隆**：fetch-depth: 1，只获取最新提交
- **增量推送**：force_orphan: false，保留 gh-pages 历史
